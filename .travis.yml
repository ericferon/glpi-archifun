language: php
php:
- '7.2'
sudo: false
branches:
  only:
  - master
#addons:
#  mariadb: '10.2'
env:
# in sequence :
# get the directory name after the sign "-"
# "git for-each-ref --sort=-taggerdate --count=1 --format '%(refname:short)' refs/tags" displays the last tag's shortname
# "git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:subject)' refs/tags" displays the last tag's first line
# "git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:body)' refs/tags" displays the last tag's 3d line and following ones
>
  - GLPI_PLUGIN_NAME=`echo $TRAVIS_BUILD_DIR | sed -e 's/^.*-//'`
    TRAVIS_TAG=`git for-each-ref --sort=-taggerdate --count=1 --format '%(refname:short)' refs/tags`
    RELEASE_NAME=`git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:subject)' refs/tags`
    RELEASE_BODY=`git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:body)' refs/tags`
install: true
script: true
after_success:
- tar --transform "s%^%$GLPI_PLUGIN_NAME/%" --show-transformed -zcvf $GLPI_PLUGIN_NAME-$TRAVIS_TAG.tar.gz ajax front inc locales sql *.png *.xml *.php  LICENSE README.md
deploy:
  provider: releases
  api_key:
    secure: UnLLhoBHiTOMoW7fKf+flpAKGwopBUWQJF9UE7No0GK9IjtbpNznbQhGMkwUnzeaeX90TUggZK4HZ9XrFG/sPtndb/zuETfhgaDuO3kaL4/i2kQsOx2HBG5rwRl1YxNfVqF08+5Is1BA6VwfR9L0Qe+SC+oWe/efDh1nNQOqweSHUcC6Grc8vhKVA2UsAYb/59143VihKA9KR1tzGHYKGlpycIidz8lsSHQXZilIIsGFPDMMa2zpZoBDEZI898a/Ou5X1zz4iu3DanbN9dOpnvkxbOBTG0TqLF1dIp9++wOAmL1kH9i1gDr+kJ7stnjFgzZNdK4z8iWNMc5bopXxW3PyH7VPmaWNOZvNJ+LPn+tPYBuCx8GgkeMjjw85afDJ5Glxl9+xZ27zDAdONQh4699hrqgS6WMK1Uvr8OP4WNn7KQJubm8ayN4RvKPOxH4DKfAXdYC6ncbay5vZ/XYy9LA3B9+x8qg6RSOwI7DE7MIpvvBIeypYiZjzrzoIuVTqPHcmJ0fVbSccthfaLoEX6dlZeUQ/iR6BEup4aZWWfyHNS2g3hTLjatZ1CdeAfuvg3Gz4vNiUXbShAkR4cpp2TahzkpGqWSnyZmQ1o5mrEktpdSXNLSBCntPl7ruz08GxwchmnQ2Hsd9iyn5Vq03U00yHEAsP+E3r2uFFs+Eoo1c=
  skip_cleanup: true
  file: $GLPI_PLUGIN_NAME-$TRAVIS_TAG.tar.gz
  name: $RELEASE_NAME
  body: $RELEASE_BODY
  prerelease: false
  on:
    repo: ericferon/glpi-$GLPI_PLUGIN_NAME
    tags: true
