language: php
php:
- '7.2'
branches:
  only:
  - master
#addons:
#  mariadb: '10.2'
env:
# in sequence :
# get the directory name after the sign "-"
# "git for-each-ref --sort=-taggerdate --count=1 --format '%(refname:short)' refs/tags" displays the last tag's shortname
# "git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:subject)' refs/tags" displays the last tag's first line
# "git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:body)' refs/tags" displays the last tag's 3d line and following ones
>
  - GLPI_PLUGIN_NAME=`echo $TRAVIS_BUILD_DIR | sed -e 's/^.*-//'`
    TRAVIS_TAG=`git for-each-ref --sort=-taggerdate --count=1 --format '%(refname:short)' refs/tags`
    RELEASE_NAME=`git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:subject)' refs/tags`
    RELEASE_BODY=`git for-each-ref --sort=-taggerdate --count=1 --format '%(contents:body)' refs/tags`
install: true
script: true
after_success:
- tar --transform "s%^%$GLPI_PLUGIN_NAME/%" --show-transformed -zcvf $GLPI_PLUGIN_NAME-$TRAVIS_TAG.tar.gz ajax front inc locales sql *.png *.xml *.php  LICENSE README.md
deploy:
  provider: releases
  token:
    secure: i302Zg7R9uTyFwry1v4VS6KePc7vSFu3rMKrZRTyzbW8mKAIFkTJ3yMSwv3lOeANLtztNFp+HiQCDNx+0P8k7YHHacRYq/aBZVoaQYoAnV5UYMIHdVPq5cCs2+Pv8KYa1tx119E6b0TWI1WuqGV2/cL1gqbPi29T4BQKNuYLjyeufrezid7bBPfpEmNgFk+W+mojXf9i1A/Pn0Xln4/0349b9jPbSljErEYGHKlXYSzITrSgHs2yo3/k++EnzjGqA3IEuXQJXFgTGPqWpJ3RV6nzFHPyquG6ilKyujzXsziYV5i5FLnzuy2YEO03nlHT+cnlNPxol9XqLhg2j566UkvXd4ie6Fi0/i65m2+WZS8uSmgLWKc6vRt0UpQFQo86ZyWO3leXN+sVnpfBJ1VN2DHfodKAlRbXQeV9q2e8OhVIayE9jWSiO/qIdLMLgzI8xBMlGz7c/0C5P3VBM+YMTF5AcTYIjM9/Bwxcsn70aOL3LRxs/LKF+0JctZfQtkBValOB+jDiAKvARnw3nvmhZknFoJEnoX67MTdnlsTXAuDk4qfjzDT91djH/slOQerTG82B0joGhLKtqa7JARWgVSkbVfc+8R9wr53XN1Bf819YqH922RZfWmH13aBOtja4+/cM8Gskwgs3ORayiZgqNu4V+TCIsn/g+YrA7+N8zJ4=
  skip_cleanup: true
  file: $GLPI_PLUGIN_NAME-$TRAVIS_TAG.tar.gz
  name: $RELEASE_NAME
  release_notes: $RELEASE_BODY
  prerelease: false
  on:
    repo: ericferon/glpi-$GLPI_PLUGIN_NAME
    tags: true
